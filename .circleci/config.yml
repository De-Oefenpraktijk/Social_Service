version: 2.1

orbs:
  sonarcloud: sonarsource/sonarcloud@1.1.0

jobs:
  build:
    docker:
      - image: mcr.microsoft.com/dotnet/sdk:6.0
    steps:
      - checkout
      - run:
          working_directory: OEF-Social_Service/OEF-Social_Service
          name: build solution
          command:| 
            dotnet restore
            dotnet build

  test:
    docker:
      - image: mcr.microsoft.com/dotnet/sdk:6.0
    steps:
      - checkout
      - run:
          working_directory: OEF-Social_Service/OEF-Social_Service.Services.XUnit
          name: Run unittests
          command: dotnet test
      - run:
          working_directory: OEF-Social_Service/OEF-Social_Service.XIntegration
          name: Run integrationtests
          command: dotnet test

workflows:
  test: 
    jobs:
      - test
    filters:
      branches:
        only: 
          - main
          - develop

  build: 
    jobs:
      - build
    requires:
      - test
    filters:
      branches:
        only: 
          - main
          - develop

